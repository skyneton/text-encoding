const encoding=new Encoding;document.getElementsByClassName("file_select_box")[0].onclick=(()=>{document.getElementsByClassName("select_encoding_file")[0].click()}),window.ondragover=(()=>{event.stopPropagation(),event.preventDefault()}),window.ondrop=(()=>{event.stopPropagation(),event.preventDefault();const e=event.target.files||event.dataTransfer.files;for(let t=0;t<e.length;t++)fileEncode(e[t])}),document.getElementsByClassName("select_encoding_file")[0].onchange=(()=>{const e=event.target.files||event.dataTransfer.files;for(let t=0;t<e.length;t++)fileEncode(e[t]);event.target.value=null});const dataSort=(e,t)=>{const n=new Intl.Collator("en",{numeric:!0,sensitivity:"base"});return e.sort((e,o)=>{const l=t(e,o);return n.compare(l[0],l[1])})},fileEncode=e=>{if(!e.type.startsWith("text"))return;const t=document.getElementsByClassName("encode_result")[0];"none"==t.style.display&&(t.style.display=null);const n=document.createElement("div");n.setAttribute("class","encode_result_box");const o=document.createElement("span");o.setAttribute("class","encode_item_fileName not_drag");const l=document.createElement("button");let s;l.setAttribute("class","encode_item_download not_drag"),l.appendChild(loadBox()),o.innerText=e.name,n.appendChild(o),n.appendChild(l),encoding.start(e,{type:document.getElementsByClassName("encoding_type")[0].value,success(e){s=e,n.setAttribute("finished",!0);const t=[...l.children];for(let e=0;e<t.length;e++)t[e].remove();l.appendChild(downloadSvg())}}),o.onclick=(()=>{if(s){const t=window.open("",`viewer_${e.name}`,"menubar=no, resizable=yes, scrollbars=yes,status=no, width=500px, height=620px");t.document.title=`Viewer - ${e.name}`;const n=t.document.createElement("iframe");n.setAttribute("style","position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 100%; height: 100%;"),n.src=s,t.document.body.appendChild(n)}}),l.onclick=(()=>{s&&download(s,o.innerText)});const a=dataSort([...t.children,n],(e,t)=>[e.getElementsByClassName("encode_item_fileName")[0].innerText,t.getElementsByClassName("encode_item_fileName")[0].innerText]);for(let e=0;e<a.length;e++)t.appendChild(a[e])},loadBox=()=>{const e=document.createElement("div");return e.setAttribute("class","loading_btn_ani"),e},downloadSvg=()=>{const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("class","download_svg"),e.setAttribute("viewBox","0 0 512 512");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M382.56,233.376C379.968,227.648,374.272,224,368,224h-64V16c0-8.832-7.168-16-16-16h-64c-8.832,0-16,7.168-16,16v208h-64 c-6.272,0-11.968,3.68-14.56,9.376c-2.624,5.728-1.6,12.416,2.528,17.152l112,128c3.04,3.488,7.424,5.472,12.032,5.472 c4.608,0,8.992-2.016,12.032-5.472l112-128C384.192,245.824,385.152,239.104,382.56,233.376z");const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M432,352v96H80v-96H16v128c0,17.696,14.336,32,32,32h416c17.696,0,32-14.304,32-32V352H432z"),e.appendChild(t),e.appendChild(n),e},download=(e,t="name.txt")=>{const n=document.createElement("a");n.target="_blank",n.href=e,n.download=t,n.click(),n.remove()};window.onload=(()=>{const e=document.getElementsByClassName("encoding_type")[0],t=encoding.types();for(let n=0;n<t.length;n++){const o=document.createElement("option");o.setAttribute("value",t[n]),o.innerText=t[n],e.appendChild(o)}});
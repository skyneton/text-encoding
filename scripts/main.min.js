const encoding=new Encoding;document.getElementsByClassName("file_select_box")[0].onclick=(()=>{document.getElementsByClassName("select_encoding_file")[0].click()}),window.ondragover=(()=>{event.stopPropagation(),event.preventDefault()}),window.ondrop=(()=>{event.stopPropagation(),event.preventDefault();const e=event.target.files||event.dataTransfer.files;for(let t=0;t<e.length;t++)fileEncode(e[t])}),document.getElementsByClassName("select_encoding_file")[0].onchange=(()=>{const e=event.target.files||event.dataTransfer.files;for(let t=0;t<e.length;t++)fileEncode(e[t]);event.target.value=null});const dataSort=(e,t)=>{const n=new Intl.Collator("en",{numeric:!0,sensitivity:"base"});return e.sort((e,o)=>{const l=t(e,o);return n.compare(l[0],l[1])})},fileEncode=e=>{if(""!=e.type&&!e.type.toLowerCase().startsWith("text"))return;const t=document.getElementsByClassName("encode_result")[0];"none"==t.style.display&&(t.style.display=null);const n=document.getElementsByClassName("encoding_type")[0].value,o=document.createElement("div");o.setAttribute("class","encode_result_box");const l=document.createElement("span");l.setAttribute("class","encode_item_fileName not_drag"),l.innerText=e.name;const c=document.createElement("div");c.setAttribute("class","encode_result_box_right");const s=document.createElement("span");s.setAttribute("class","before_encoding_type not_drag"),s.innerText=n;const a=document.createElement("button");let d;a.setAttribute("class","encode_item_download not_drag"),a.appendChild(loadBox()),c.appendChild(s),c.appendChild(a),o.appendChild(l),o.appendChild(c),encoding.start(e,{type:n,success(e,t){d=e,o.setAttribute("finished",!0);const l=[...a.children];for(let e=0;e<l.length;e++)l[e].remove();n!==t&&(s.innerText=t,s.setAttribute("title",(()=>{switch(document.title){case"텍스트 인코딩 변환 - 텍스트를 UTF-8로 변환":return"감지됨";case"テキストエンコードへんかん - テキストをUTF-8へんかん":return"かんち";default:return"Detected"}})())),a.appendChild(downloadSvg())}}),l.onclick=(()=>{d&&(null!=l.previewSrc&&window.open(l.previewSrc),fetch(d).then(e=>e.blob()).then(e=>{window.open(l.previewSrc=URL.createObjectURL(new Blob(["\ufeff",e],{type:"text/plain"})))}))}),a.onclick=(()=>{d&&download(d,l.innerText)});const r=dataSort([...t.children,o],(e,t)=>[e.getElementsByClassName("encode_item_fileName")[0].innerText,t.getElementsByClassName("encode_item_fileName")[0].innerText]);for(let e=0;e<r.length;e++)t.appendChild(r[e])},loadBox=()=>{const e=document.createElement("div");return e.setAttribute("class","loading_btn_ani"),e},downloadSvg=()=>{const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("class","download_svg"),e.setAttribute("viewBox","0 0 512 512");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M382.56,233.376C379.968,227.648,374.272,224,368,224h-64V16c0-8.832-7.168-16-16-16h-64c-8.832,0-16,7.168-16,16v208h-64 c-6.272,0-11.968,3.68-14.56,9.376c-2.624,5.728-1.6,12.416,2.528,17.152l112,128c3.04,3.488,7.424,5.472,12.032,5.472 c4.608,0,8.992-2.016,12.032-5.472l112-128C384.192,245.824,385.152,239.104,382.56,233.376z");const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","M432,352v96H80v-96H16v128c0,17.696,14.336,32,32,32h416c17.696,0,32-14.304,32-32V352H432z"),e.appendChild(t),e.appendChild(n),e},download=(e,t="name.txt")=>{const n=document.createElement("a");n.target="_blank",n.href=e,n.download=t,n.click(),n.remove()};window.onload=(()=>{const e=document.getElementsByClassName("encoding_type")[0],t=encoding.types();for(let n=0;n<t.length;n++){const o=document.createElement("option");o.setAttribute("value",t[n]),o.innerText=t[n],e.appendChild(o)}});